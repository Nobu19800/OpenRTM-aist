<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">   
  <?define ProductName = "{% Product.Name %}-{% Product.Version %}"?>
  <Product Name="{% Product.Name %}-{% Product.Version %}" 
           Id="{% Product.Id %}"
           Language='$(var.language)'
	   Codepage='$(var.codepage)'
	   Version="{% Product.Version %}" 
           Manufacturer="{% Product.Manufacturer %}"
           UpgradeCode="{% Product.UpgradeCode %}">

    <Package Id="*" 
             Keywords="Installer"
             Description="{% Package.Description %}"
             InstallerVersion="{% Package.InstallerVersion %}"
	     Languages='$(var.language)'
             Compressed="{% Package.Compressed %}"
	     SummaryCodepage='$(var.codepage)' />
    <!-- メディア -->    
    <Media Id="1" Cabinet="OpenRTM-aist.cab" EmbedCab="yes"/>

    <!-- フォルダ構成 -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <!-- Program Files フォルダ -->
      <Directory Id="ProgramFilesFolder" SourceName="PFILE">
	<Directory Id="INSTALLLOCATION"
		   Name="{% Product.Name %}">
	  <Directory Id="Version"
		     Name="{% Product.ShortVersion %}">
	    <!-- bin -->
	    <Directory Id="bin" Name="bin">
	      <Component Id="Bin" Guid="{% Bin.GUID %}">
		<Environment Id='RTM_ROOT' Name='RTM_ROOT' Action='set'
			     System='no' Part='all' Value='[Version]' />
		<Environment Id='UpdatePath' Name='PATH' Action='set'
			     System='no' Part='last'
			     Value='[bin]' />
		{% for file in Bin.Files %}
		<File Id="{% file.Id %}"
		      Name="{% file.Name %}" DiskId="1"
		      Source="{% file.Source %}">
		  {% if file.Name is rtm-naming.bat %}
		  <Shortcut Id="{% file.Id %}" Directory="ToolsMenuFolder"
			    Name="Start Naming Service"
			    Show="normal" WorkingDirectory="tools"/>
		  {% endif %}
		</File>
		{% endfor %}
		{% for file in Rtcd.Files %}
		<File Id="{% file.Id %}"
		      Name="{% file.Name %}" DiskId="1"
		      Source="{% file.Source %}">
		</File>
		{% endfor %}
	      </Component>
	    </Directory>
	    <!-- etc -->
	    <Directory Id="etc" Name="etc">
	      <Component Id="Etc" Guid="{% Etc.GUID %}">
		{% for file in Etc.Files %}
		<File Id="{% file.Id %}"
		      Name="{% file.Name %}" DiskId="1"
		      Source="{% file.Source %}">
		</File>
		{% endfor %}
	      </Component>
	    </Directory>
	    <!-- rtm -->
	    <Directory Id="rtm" Name="rtm">
	      <Component Id="Headers" Guid="{% Headers.GUID %}">
		{% for file in Headers.Files %}
		<File Id="{% file.Id %}"
		      Name="{% file.Name %}" DiskId="1"
		      Source="{% file.Source %}"/>
		{% endfor %}
	      </Component>
	      <!-- idl -->
	      <Directory Id="idl" Name="idl">
		<Component Id="IDLs" Guid="{% IDLs.GUID %}">
		  {% for file in IDLs.Files %}
		  <File Id="{% file.Id %}"
			Name="{% file.Name %}" DiskId="1"
			Source="{% file.Source %}"/>
		  {% endfor %}
		</Component>
	      </Directory><!--end of idl-->
	    </Directory><!--end of rtm-->
	    <!-- coil -->
	    <Directory Id="coil" Name="coil">
	      <Component Id="COILs" Guid="{% COILs.GUID %}">
		{% for file in COILs.Files %}
		<File Id="{% file.Id %}"
		      Name="{% file.Name %}" DiskId="1"
		      Source="{% file.Source %}"/>
		{% endfor %}
	      </Component>
	    </Directory><!--end of coil-->
	    
	    <!-- doc -->
	    <Directory Id="doc" Name="doc">
	      <Directory Id="CXXdoc" Name="C++">
		<!-- Classref_jp -->
		<Directory Id="classref_jp" Name="classref_jp">
		  <Component Id="Classref_jp" Guid="{% Classref_jp.GUID %}">
	      	    {% for file in Classref_jp.Files %}
		    <File Id="{% file.Id %}"
			  Name="{% file.Name %}" DiskId="1"
			  Source="{% file.Source %}">
		      {% if file.Name is index.html %}
		      <Shortcut Id="{% file.Id %}" Directory="DocMenuFolder"
				Name="Japanese Class reference"
				Show="normal"/>
		      {% endif %}
		    </File>
		    {% endfor %}
		  </Component>
		</Directory>
		<!-- Classref_en -->
		<Directory Id="classref_en" Name="classref_en">
		  <Component Id="Classref_en" Guid="{% Classref_en.GUID %}">
	      	    {% for file in Classref_en.Files %}
		    <File Id="{% file.Id %}"
			  Name="{% file.Name %}" DiskId="1"
			  Source="{% file.Source %}">
		      {% if file.Name is index.html %}
		      <Shortcut Id="{% file.Id %}" Directory="DocMenuFolder"
				Name="English Class reference"
				Show="normal"/>
		      {% endif %}
		    </File>
		    {% endfor %}
		  </Component>
		</Directory>
		<!-- IDLref_jp -->
		<Directory Id="idlref_jp" Name="idlref_jp">
		  <Component Id="IDLref_jp" Guid="{% IDLref_jp.GUID %}">
	      	    {% for file in IDLref_jp.Files %}
		    <File Id="{% file.Id %}"
			  Name="{% file.Name %}" DiskId="1"
			  Source="{% file.Source %}">
		      {% if file.Name is index.html %}
		      <Shortcut Id="{% file.Id %}" Directory="DocMenuFolder"
				Name="Japanese IDL reference"
				Show="normal"/>
		      {% endif %}
		    </File>
		    {% endfor %}
		  </Component>
		</Directory>
		<!-- IDLref_en -->
		<Directory Id="idlref_en" Name="idlref_en">
		  <Component Id="IDLref_en" Guid="{% IDLref_en.GUID %}">
	      	    {% for file in IDLref_en.Files %}
		    <File Id="{% file.Id %}"
			  Name="{% file.Name %}" DiskId="1"
			  Source="{% file.Source %}">
		      {% if file.Name is index.html %}
		      <Shortcut Id="{% file.Id %}" Directory="DocMenuFolder"
				Name="English IDL reference"
				Show="normal"/>
		      {% endif %}
		    </File>
		    {% endfor %}
		  </Component>
		</Directory>
	      </Directory>
	    </Directory><!--end of doc-->
	    
	    <!-- utils -->
	    <Directory Id="utils" Name="utils">
	      <Directory Id="rtc_template"
			 Name="rtc-template">
		<Component Id="RtcTemplate" Guid="{% RtcTemplate.GUID %}">
		  <Environment Id='UpdatePath2' Name='PATH' Action='set'
			       System='no' Part='all'
			       Value='[rtc_template]' />
	      	  {% for file in RtcTemplate.Files %}
		  <File Id="{% file.Id %}"
			Name="{% file.Name %}" DiskId="1"
			Source="{% file.Source %}"/>
		  {% endfor %}
		</Component>
	      </Directory>
	    </Directory>
	    
	    <!-- examples -->
	    <Directory Id="examples" Name="examples">
	      <Directory Id="CXXexamples" Name="C++">
		<Component Id="Examples" Guid="{% Examples.GUID %}">
		  {% for file in Examples.Files %}
		  <File Id="{% file.Id %}"
			Name="{% file.Name %}" DiskId="1"
			Source="{% file.Source %}">
		    {% if-any file.Shortcut %}{% if file.Shortcut is True %}
		    <Shortcut Id="{% file.Id %}" Directory="ExpMenuFolder"
			      Name="{% file.Name %}"
			      Show="normal"
			      WorkingDirectory="CXXexamples"
			      Icon="RTC.ico" IconIndex="0"
			      {% if-any file.Arguments %}
			      Arguments='{% file.Arguments %}'{% endif %}> 
		      {% if file.Name is ConsoleInComp.exe %}
		      <Icon Id="RTC.ico" SourceFile="Bitmaps\RTC.ico"/>
		      {% endif %}
		    </Shortcut>
		    {% endif %}{% endif %}
		  </File>
		  {% endfor %}
		</Component>
	      </Directory>
	    </Directory>
	  </Directory>
	</Directory><!--end of OpenRTM-aist-->

	<?if $(env.INCLUDE_OMNIORB) = YES ?>
	<Directory Id="omniORB" Name="omniORB">
	<?include omniORB_inc.wxs ?>
	</Directory>
	<?endif ?>

      </Directory>

      <!-- システムフォルダ -->
      <Directory Id="SystemFolder"
		 SourceName="System32">

      </Directory>
      <!-- プログラムフォルダ -->
      <Directory Id="ProgramMenuFolder">
	<Directory Id="AppMenuFolder"
		   Name="{% Product.Name %}">
	  <Directory Id="CxxMenuFolder" Name="C++">
	    <Directory Id="ToolsMenuFolder" Name="tools">
	    </Directory>
	    <Directory Id="Components" Name="components">
	      <Directory Id="ExpMenuFolder" Name="examples">
	      </Directory>
	    </Directory>
	    <Directory Id="DocMenuFolder" Name="documents">
	    </Directory>
	  </Directory>
	</Directory>
      </Directory>
    </Directory>
    
    <Feature Id="Runtime" Level="1" Title="Runtime Environment">
      <ComponentRef Id="Bin"/>
      <ComponentRef Id="COILs"/>
      <ComponentRef Id="Etc"/>

      <?if $(env.INCLUDE_OMNIORB) = YES ?>
      <ComponentRef Id="Omni"/>
      <ComponentRef Id="OmniBinScripts"/>
      <ComponentRef Id="OmniBinX86_win32"/>
      <?endif ?>
    </Feature>
    <Feature Id="Samples" Level="1" Title="Samples">
      <ComponentRef Id="Examples"/>
    </Feature>
    <Feature Id="Devel" Level="1" Title="Development Environment">
      <ComponentRef Id="Headers"/>
      <ComponentRef Id="IDLs"/>
      <ComponentRef Id="RtcTemplate"/>

      <?if $(env.INCLUDE_OMNIORB) = YES ?>
      <ComponentRef Id="OmniIdl"/>
      <ComponentRef Id="OmniIdlCos"/>
      <ComponentRef Id="OmniInclude"/>
      <ComponentRef Id="OmniIncludeCos"/>
      <ComponentRef Id="OmniIncludeOmniorb4"/>
      <ComponentRef Id="OmniIncludeOmniorb4Internal"/>
      <ComponentRef Id="OmniIncludeOmnithread"/>
      <ComponentRef Id="OmniIncludeOmnivms"/>
      <ComponentRef Id="OmniIncludePython1_5"/>
      <ComponentRef Id="OmniLibPythonOmniidl"/>
      <ComponentRef Id="OmniLibPythonOmniidl_be"/>
      <ComponentRef Id="OmniLibPythonOmniidl_beCxx"/>
      <ComponentRef Id="OmniLibPythonOmniidl_beCxxDynskel"/>
      <ComponentRef Id="OmniLibPythonOmniidl_beCxxHeader"/>
      <ComponentRef Id="OmniLibPythonOmniidl_beCxxImpl"/>
      <ComponentRef Id="OmniLibPythonOmniidl_beCxxSkel"/>
      <ComponentRef Id="OmniLibX86_win32"/>
      <?endif ?>
    </Feature>
    <Feature Id="Docs" Level="1" Title="Documents">
      <ComponentRef Id="Classref_jp"/>
      <ComponentRef Id="Classref_en"/>
      <ComponentRef Id="IDLref_jp"/>
      <ComponentRef Id="IDLref_en"/>
    </Feature>

    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="Bitmaps/bannrbmp.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="Bitmaps/dlgbmp.bmp" />

    <UIRef Id="WixUI_Mondo" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLLOCATION" />
  </Product>
</Wix>
